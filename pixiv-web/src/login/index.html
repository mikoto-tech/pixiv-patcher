<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>注册登录界面Ⅰ</title>
        <link
            rel="stylesheet"
            href="https://cdn.staticfile.org/normalize/8.0.1/normalize.min.css"
        />
        <link rel="stylesheet" href="css/style.css" />
    </head>
    <body>
        <style>
            .vaptcha-init-main {
                display: table;
                width: 100%;
                height: 100%;
                background-color: #eeeeee;
            }
            .vaptcha-init-loading {
                display: table-cell;
                vertical-align: middle;
                text-align: center;
            }
            .vaptcha-init-loading > a {
                display: inline-block;
                width: 18px;
                height: 18px;
                border: none;
            }
            .vaptcha-init-loading .vaptcha-text {
                font-family: sans-serif;
                font-size: 12px;
                color: #cccccc;
                vertical-align: middle;
            }
        </style>
        <div class="container right-panel-active">
            <!-- 注册 -->
            <div class="container_form container--signup">
                <form action="#" class="form" id="form1">
                    <h2 class="form_title">注册</h2>
                    <input
                        type="text"
                        placeholder="User"
                        class="input"
                        id="userName"
                    />
                    <input
                        type="email"
                        placeholder="Email"
                        class="input"
                        id="userEmail"
                    />
                    <input
                        type="password"
                        placeholder="Password"
                        class="input"
                        id="userPassword"
                    />
                    <input
                        type="password"
                        placeholder="Password Confirm"
                        class="input"
                    />
                    <div
                        id="vaptchaContainer"
                        style="width: 300px; height: 36px"
                    >
                        <!--vaptcha-container是用来引入VAPTCHA的容器，下面代码为预加载动画，仅供参考-->
                        <div class="vaptcha-init-main">
                            <div class="vaptcha-init-loading">
                                <a href="/" target="_blank">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="48px"
                                        height="60px"
                                        viewBox="0 0 24 30"
                                        style="
                                            enable-background: new 0 0 50 50;
                                            width: 14px;
                                            height: 14px;
                                            vertical-align: middle;
                                        "
                                        xml:space="preserve"
                                    >
                                        <rect
                                            x="0"
                                            y="9.22656"
                                            width="4"
                                            height="12.5469"
                                            fill="#CCCCCC"
                                        >
                                            <animate
                                                attributeName="height"
                                                attributeType="XML"
                                                values="5;21;5"
                                                begin="0s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                            <animate
                                                attributeName="y"
                                                attributeType="XML"
                                                values="13; 5; 13"
                                                begin="0s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                        </rect>
                                        <rect
                                            x="10"
                                            y="5.22656"
                                            width="4"
                                            height="20.5469"
                                            fill="#CCCCCC"
                                        >
                                            <animate
                                                attributeName="height"
                                                attributeType="XML"
                                                values="5;21;5"
                                                begin="0.15s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                            <animate
                                                attributeName="y"
                                                attributeType="XML"
                                                values="13; 5; 13"
                                                begin="0.15s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                        </rect>
                                        <rect
                                            x="20"
                                            y="8.77344"
                                            width="4"
                                            height="13.4531"
                                            fill="#CCCCCC"
                                        >
                                            <animate
                                                attributeName="height"
                                                attributeType="XML"
                                                values="5;21;5"
                                                begin="0.3s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                            <animate
                                                attributeName="y"
                                                attributeType="XML"
                                                values="13; 5; 13"
                                                begin="0.3s"
                                                dur="0.6s"
                                                repeatCount="indefinite"
                                            ></animate>
                                        </rect>
                                    </svg>
                                </a>
                                <span class="vaptcha-text"
                                    >Vaptcha Initializing...</span
                                >
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="register()">注册</button>
                </form>
            </div>

            <!-- 登录 -->
            <div class="container_form container--signin">
                <form action="#" class="form" id="form2">
                    <h2 class="form_title">登录</h2>
                    <input
                        type="text"
                        placeholder="User"
                        class="input"
                        id="loginUserName"
                    />
                    <input
                        type="password"
                        placeholder="Password"
                        class="input"
                        id="loginUserPassword"
                    />
                    <a href="#" class="link">忘记密码了?</a>
                    <button class="btn" onclick="login()">登录</button>
                </form>
            </div>

            <!-- 浮层 -->
            <div class="container_overlay">
                <div class="overlay">
                    <div class="overlay_panel overlay--left">
                        <button class="btn" id="signIn">登录</button>
                    </div>
                    <div class="overlay_panel overlay--right">
                        <button class="btn" id="signUp">注册</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 背景 -->
        <div class="slidershow">
            <div
                class="slidershow--image"
                style="background-image: url('img/89665028_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/89834220_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90035289_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90050826_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90093396_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90137788_p0-min.png')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90244316_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90276008_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90283750_p0-min.png')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90859195_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/90892262_p0-min.png')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/91014617_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="
                    background-image: url('img/91020172_p0_master1200-min.jpg');
                "
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/91262365_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/91346705_p0-min.jpg')"
            ></div>
            <div
                class="slidershow--image"
                style="background-image: url('img/91362440_p0-min.png')"
            ></div>
        </div>

        <!-- partial -->
        <script src="https://cdn.staticfile.org/js-sha256/0.9.0/sha256.js"></script>
        <script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script>
        <script src="js/script.js"></script>
        <script src="https://v-cn.vaptcha.com/v3.js"></script>
        <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
        <script>
            function Base64() {

                // private property
                _keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

                // public method for encoding
                this.encode = function (input) {
                    var output = "";
                    var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
                    var i = 0;
                    input = _utf8_encode(input);
                    while (i < input.length) {
                        chr1 = input.charCodeAt(i++);
                        chr2 = input.charCodeAt(i++);
                        chr3 = input.charCodeAt(i++);
                        enc1 = chr1 >> 2;
                        enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                        enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                        enc4 = chr3 & 63;
                        if (isNaN(chr2)) {
                            enc3 = enc4 = 64;
                        } else if (isNaN(chr3)) {
                            enc4 = 64;
                        }
                        output = output +
                            _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +
                            _keyStr.charAt(enc3) + _keyStr.charAt(enc4);
                    }
                    return output;
                }

                // public method for decoding
                this.decode = function (input) {
                    var output = "";
                    var chr1, chr2, chr3;
                    var enc1, enc2, enc3, enc4;
                    var i = 0;
                    input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                    while (i < input.length) {
                        enc1 = _keyStr.indexOf(input.charAt(i++));
                        enc2 = _keyStr.indexOf(input.charAt(i++));
                        enc3 = _keyStr.indexOf(input.charAt(i++));
                        enc4 = _keyStr.indexOf(input.charAt(i++));
                        chr1 = (enc1 << 2) | (enc2 >> 4);
                        chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                        chr3 = ((enc3 & 3) << 6) | enc4;
                        output = output + String.fromCharCode(chr1);
                        if (enc3 !== 64) {
                            output = output + String.fromCharCode(chr2);
                        }
                        if (enc4 !== 64) {
                            output = output + String.fromCharCode(chr3);
                        }
                    }
                    output = _utf8_decode(output);
                    return output;
                }

                // private method for UTF-8 encoding
                const _utf8_encode = function (string) {
                    string = string.replace(/\r\n/g, "\n");
                    let utfText = "";
                    for (var n = 0; n < string.length; n++) {
                        var c = string.charCodeAt(n);
                        if (c < 128) {
                            utfText += String.fromCharCode(c);
                        } else if ((c > 127) && (c < 2048)) {
                            utfText += String.fromCharCode((c >> 6) | 192);
                            utfText += String.fromCharCode((c & 63) | 128);
                        } else {
                            utfText += String.fromCharCode((c >> 12) | 224);
                            utfText += String.fromCharCode(((c >> 6) & 63) | 128);
                            utfText += String.fromCharCode((c & 63) | 128);
                        }

                    }
                    return utfText;
                }

                // private method for UTF-8 decoding
                _utf8_decode = function (utfText) {
                    let string = "";
                    let i = 0;
                    let c1;
                    let c = c1 = c2 = 0;
                    while ( i < utfText.length ) {
                        c = utfText.charCodeAt(i);
                        if (c < 128) {
                            string += String.fromCharCode(c);
                            i++;
                        } else var c2;
                        if ((c > 191) && (c < 224)) {
                            c2 = utfText.charCodeAt(i + 1);
                            string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                            i += 2;
                        } else {
                            c2 = utfText.charCodeAt(i + 1);
                            c3 = utfText.charCodeAt(i + 2);
                            string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                            i += 3;
                        }
                    }
                    return string;
                }
            }
            try {
                const userIp = returnCitySN["cip"];
            } catch (error) {
                alert(
                    "我们需要确定您的真实IP,以防止机器人攻击.请关闭ADBlock等软件,因为这会阻止我们获取您的IP"
                );
                document.getElementsByTagName("html")[0].innerHTML =
                    "我们需要确定您的真实IP,以防止机器人攻击.请关闭ADBlock等软件,因为这会阻止我们获取您的IP";
            }

            function register() {
                vaptcha({
                    vid: "60c634906aed7207789f4ddf", // 验证单元id
                    mode: "click", // 显示类型 点击式
                    scene: 0, // 场景值 默认0
                    container: "#vaptchaContainer", // 容器，可为Element 或者 selector
                    // 可选参数
                    // lang: 'auto', // 语言 默认auto,可选值auto,zh-CN,en,zh-TW,jp
                    // style: 'dark' //按钮样式 默认dark，可选值 dark,light
                    // color: '#57ABFF' //按钮颜色 默认值#57ABFF
                    // area: 'auto' //验证节点区域,默认 auto,可选值 auto,sea,na,cn
                }).then(function (vaptchaObj) {
                    obj = vaptchaObj; //将VAPTCHA验证实例保存到局部变量中
                    vaptchaObj.render(); // 调用验证实例 vpObj 的 render 方法加载验证按钮
                    //获取token的方式一：
                    //vaptchaObj.renderTokenInput('.login-form')//以form的方式提交数据时，使用此函数向表单添加server,token值
                    //获取token的方式二：
                    vaptchaObj.listen("pass", function () {
                        var serverToken = vaptchaObj.getServerToken();
                        // 验证成功进行后续操作
                        var data = {
                            workType: "register",
                            server: serverToken.server,
                            token: serverToken.token,
                            userName: document.getElementById("userName").value,
                            userPassword: sha256(
                                document.getElementById("userPassword").value +
                                    salt
                            ),
                            userPasswordSalt: salt,
                            userEmail:
                                document.getElementById("userEmail").value,
                            userIp: returnCitySN["cip"],
                        };
                        $.post(
                            "http://test.pixiv.mikoto.net.cn/ajax.php",
                            data,
                            function (r) {
                                if (!r["error"]) {
                                    alert("注册成功");
                                } else {
                                    alert("注册失败\n原因: " + r['msg']);
                                    vaptchaObj.reset(); //重置 VAPTCHA
                                }
                            }
                        );
                    });
                    //关闭验证弹窗时触发
                    vaptchaObj.listen("close", function () {});
                });
            }

            function login() {
                var base = new Base64();
                var data = {
                    workType: "login",
                    userName: document.getElementById("loginUserName").value,
                    userPassword: base.encode(document.getElementById("loginUserPassword").value),
                    userIp: returnCitySN["cip"],
                };
                $.post(
                    "http://test.pixiv.mikoto.net.cn/ajax.php",
                    data,
                    function (r) {
                        if (!r["error"]) {
                            alert("登录成功");
                        } else {
                            alert("登录失败\n原因: " + r['msg']);
                        }
                    }
                );
            }
        </script>
    </body>
</html>
