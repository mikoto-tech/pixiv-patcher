<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8"/>
  <meta
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport"
  />
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <title>Mikoto-Pixiv-Patcher</title>
  <style>
    #footer {
      bottom: 0;
      width: 100%;
      height: 15%;
      padding: 20px 0;
      background: #99cc99;
      margin: 0;
      color: #ffffff;
      text-align: center;
    }

    #footer ul li {
      padding: 10px 0;
      list-style: none;
      color: #ffffff;
    }

    #footer ul li a {
      text-decoration: none;
      color: #ffffff;
    }

    button {
      background-color: #ffffff;
      border-radius: 40px;
      border: 1px solid #99cc99;
      padding: 10px;
      -webkit-transition-duration: 0.4s; /* Safari */
      transition-duration: 0.4s;
      font-family: "Agency FB", serif;
      font-size: large;
      font-style: initial;
      width: 100px;
    }

    button:hover {
      background-color: #99cc99; /* Green */
      color: white;
    }
  </style>
</head>
<body style="background-color: #ffcccc">
<h1>
  Here is
  <a href="https://github.com/mikoto-tech/pixiv-patcher">Pixiv-Patcher</a>
</h1>
<div id="menu">
  <ul id="configs"></ul>
  <ul id="patchers"></ul>
  <ul>
    PatcherCreater
    <li>ConfigName: <input id="configName"/></li>
    <li>PatcherName: <input id="patcherName"/></li>
    <li>
      <button onclick="create()">Create</button>
    </li>
  </ul>
  <ul>
    ThreadPool
    <li id="threadPool-activeCount"></li>
    <li id="threadPool-completedTaskCount"></li>
    <li id="threadPool-corePoolSize"></li>
    <li id="threadPool-maximumPoolSize"></li>
    <li id="threadPool-taskCount"></li>
  </ul>
  <br/>
</div>
<div id="footer">
  <ul>
    <li>
      <a href="https://github.com/mikoto-tech/pixiv-patcher">Github</a>
    </li>
    <li>@author <a href="https://github.com/mikoto2464/">mikoto</a></li>
    <li>
      Create this system by using
      <a href="https://spring.io/projects/spring-boot">spring-boot</a>
    </li>
  </ul>
</div>
<script>
  var configHttpRequest = new XMLHttpRequest();
  configHttpRequest.onreadystatechange = function () {
    if (
            configHttpRequest.readyState == 4 &&
            configHttpRequest.status == 200
    ) {
      if (configHttpRequest.responseText != "") {
        var configs = "Configs";

        JSON.parse(configHttpRequest.responseText).forEach((element) => {
          configs +=
                  '<li><a href="/console/configSetter.html">' +
                  element["configName"] +
                  "</a></li>";
        });
        document.getElementById("configs").innerHTML = configs;
      }
    }
  };
  configHttpRequest.open("GET", "/api/config/getAll", true);
  configHttpRequest.send();

  var patcherHttpRequest = new XMLHttpRequest();
  patcherHttpRequest.onreadystatechange = function () {
    if (
            patcherHttpRequest.readyState == 4 &&
            patcherHttpRequest.status == 200
    ) {
      if (patcherHttpRequest.responseText != "") {
        var patchers = "Patchers";

        JSON.parse(patcherHttpRequest.responseText).forEach((element) => {
          patchers +=
                  '<li><span name="patcher">' +
                  element["patcherName"] +
                  "</span></li>";
          if (element["patcher"]["start"]) {
            patchers +=
                    '<button id="patcher-' +
                    element["patcherName"] +
                    '-button">Stop</button></li>';
          } else {
            patchers +=
                    '<button id="patcher-' +
                    element["patcherName"] +
                    '-button">Start</button></li>';
          }
        });
        document.getElementById("patchers").innerHTML = patchers;
        document.getElementsByName("patcher").forEach(element => {
          var button = document.getElementById("patcher-" + element.innerHTML + "-button");
          if (button.innerHTML == "Stop") {
            button.onclick = function () {
              stopPatcher(element.innerHTML);
            }
          } else {
            button.onclick = function () {
              startPatcher(element.innerHTML);
            }
          }
        });
      }
    }
  };
  patcherHttpRequest.open("GET", "/api/patcher/getAll", true);
  patcherHttpRequest.send();

  var threadPoolHttpRequest = new XMLHttpRequest();
  threadPoolHttpRequest.onreadystatechange = function () {
    if (
            threadPoolHttpRequest.readyState == 4 &&
            threadPoolHttpRequest.status == 200
    ) {
      var responseJSON = JSON.parse(threadPoolHttpRequest.responseText);
      document.getElementById("threadPool-activeCount").innerHTML = "activeCount: " + responseJSON["activeCount"];
      document.getElementById("threadPool-completedTaskCount").innerHTML = "completedTaskCount: " + responseJSON["completedTaskCount"];
      document.getElementById("threadPool-corePoolSize").innerHTML = "corePoolSize: " + responseJSON["corePoolSize"];
      document.getElementById("threadPool-maximumPoolSize").innerHTML = "maximumPoolSize: " + responseJSON["maximumPoolSize"];
      document.getElementById("threadPool-taskCount").innerHTML = "taskCount: " + responseJSON["taskCount"];
    }
  };
  threadPoolHttpRequest.open("GET", "/api/patcher/getThreadPool", true);
  threadPoolHttpRequest.send();

  function create() {
    var configName = document.getElementById("configName").value;
    var patcherName = document.getElementById("patcherName").value;

    var createHttpRequest = new XMLHttpRequest();
    createHttpRequest.onreadystatechange = function () {
      if (
              createHttpRequest.readyState == 4 &&
              createHttpRequest.status == 200
      ) {
        var responseJSON = JSON.parse(createHttpRequest.responseText);
        if (responseJSON["success"]) {
          location.reload();
        }
      }
    };
    createHttpRequest.open(
            "GET",
            "/api/patcher/create?patcherName=" + patcherName + "&configName=" + configName,
            true
    );
    createHttpRequest.send();
  }

  function startPatcher(patcherName) {
    var startPatcherHttpRequest = new XMLHttpRequest();
    startPatcherHttpRequest.onreadystatechange = function () {
      if (
              startPatcherHttpRequest.readyState == 4 &&
              startPatcherHttpRequest.status == 200
      ) {
        var responseJSON = JSON.parse(startPatcherHttpRequest.responseText);
        if (responseJSON["success"]) {
          location.reload();
        }
      }
    };
    startPatcherHttpRequest.open(
            "GET",
            "/api/patcher/start?patcherName=" + patcherName,
            true
    );
    startPatcherHttpRequest.send();
  }

  function stopPatcher(patcherName) {
    var stopPatcherHttpRequest = new XMLHttpRequest();
    stopPatcherHttpRequest.onreadystatechange = function () {
      if (
              stopPatcherHttpRequest.readyState == 4 &&
              stopPatcherHttpRequest.status == 200
      ) {
        var responseJSON = JSON.parse(stopPatcherHttpRequest.responseText);
        if (responseJSON["success"]) {
          location.reload();
        }
      }
    };
    stopPatcherHttpRequest.open(
            "GET",
            "/api/patcher/stop?patcherName=" + patcherName,
            true
    );
    stopPatcherHttpRequest.send();
  }
</script>
</body>
</html>
